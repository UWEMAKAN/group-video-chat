(this["webpackJsonpgroup-video-chat"]=this["webpackJsonpgroup-video-chat"]||[]).push([[0],{20:function(e,t,n){e.exports={CreateRoom:"CreateRoom_CreateRoom__19d9W",Button:"CreateRoom_Button__3_plR"}},21:function(e,t,n){e.exports={Video:"Video_Video__b-Hlw"}},46:function(e,t,n){e.exports={Window:"Window_Window__25YSi"}},47:function(e,t,n){e.exports={Quadruple:"QuadruplePeersView_Quadruple__33wNV"}},53:function(e,t,n){e.exports=n(95)},58:function(e,t,n){},88:function(e,t){},95:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),c=n(42),a=n.n(c),i=(n(58),n(48)),s=n(1),u=n(97),d=n(20),l=n.n(d),m=function(e){return r.a.createElement("div",{className:l.a.CreateRoom},r.a.createElement("button",{className:l.a.Button,onClick:function(){var t=Object(u.a)();e.history.push("/rooms/".concat(t))}},"Create room"))},f=n(50),p=n(8),h=n(43),C=n(44),v=n(52),g=n(51),w=n(45),O=n.n(w),S=n(46),b=n.n(S),k=n(47),V=n.n(k),j=n(21),R=n.n(j),E=function(e){return e.muted?r.a.createElement("video",{muted:!0,className:R.a.Video,ref:e.videoRef,autoPlay:!0,playsInline:!0}):r.a.createElement("video",{className:R.a.Video,ref:e.videoRef,autoPlay:!0,playsInline:!0})},I=function(e){var t=e.localVideo,n=e.remoteVideos,o=n.length?n.map((function(e,t){return r.a.createElement(E,{videoRef:e})})):null;return r.a.createElement("div",{className:V.a.Quadruple},r.a.createElement(E,{videoRef:t,muted:!0}),o)},y=function(e){return r.a.createElement("div",{className:b.a.Window},r.a.createElement(I,e))},N=function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={localStream:null,remoteStreams:[],offers:[],token:null},r.onMediaStream=function(e){r.setState((function(t){return Object(p.a)(Object(p.a)({},t),{},{localStream:e})})),r.localVideo.current.srcObject=e,r.localVideo.current.volume=0,r.socket.current.emit("join room",r.roomId),r.socket.current.on("token",r.onToken),r.socket.current.on("offer",r.onOffer),r.socket.current.on("all users",r.onAllUsers),r.socket.current.on("new user",r.onNewUser),r.socket.current.on("answer",r.onAnswer)},r.onAnswer=function(e){console.log("answer received");var t=JSON.parse(e);console.log(t);var n=new RTCSessionDescription(t.answer);r.peerConnections.current.filter((function(e){return e.id===t.id}))[0].peerConnection.setRemoteDescription(n),r.connectionStatuses.current[t.id]=!0,console.log("local ICE Candidates",r.localICECandidates.current);var o=r.localICECandidates.current[t.id];console.log("logging candidate",o),r.socket.current.emit("candidate",JSON.stringify({id:t.id,candidate:o})),console.log("candidate emitted")},r.onOffer=function(e){console.log("offer received");var t=JSON.parse(e);console.log(t),console.log(r.peerConnections.current.filter((function(e){return e.id===t.id}))),r.createAnswer(t)()},r.onToken=function(e){r.setState((function(t){return Object(p.a)(Object(p.a)({},t),{},{token:e})})),r.socket.current.on("candidate",r.onCandidate)},r.createAnswer=function(e){return function(){console.log("creating answer"),r.connectionStatuses.current[e.id]=!0;var t=new RTCSessionDescription(e.offer);console.log("rtcSesstionDescription ",t);var n=r.peerConnections.current.filter((function(t){return t.id===e.id}))[0].peerConnection;n.setRemoteDescription(t),n.createAnswer((function(t){console.log("answer created",t),n.setLocalDescription(t),console.log("local description set");var o={id:e.id,answer:t};r.socket.current.emit("answer",JSON.stringify(o)),console.log("answer emitted")}),(function(e){console.log(e)}))}},r.createOffer=function(e,t){e.createOffer((function(n){e.setLocalDescription(n);var o={id:t.userId,offer:n};r.socket.current.emit("offer",JSON.stringify(o)),console.log("offer emitted")}),(function(e){console.log(e)}))},r.onAllUsers=function(e){e.forEach((function(e){r.peers.current.push({userId:e}),r.connectionStatuses.current[e]=!1})),r.peers.current.length>0&&(r.peers.current.forEach((function(e){var t=r.createPeerConnection(e);r.createOffer(t,e),console.log("offer created"),r.peerConnections.current.push({id:e.userId,peerConnection:t})})),console.log("all users peerConnections updated"))},r.onNewUser=function(e){console.log("new user");var t={userId:e};r.peers.current.push(t),r.connectionStatuses.current[e]=!1;var n=r.createPeerConnection(t);r.peerConnections.current.push({id:t.userId,peerConnection:n}),console.log("new user peerConnections updated")},r.createPeerConnection=function(e){var t=r.createConnection(),n=r.addStreamToPeerConnection(t);return r.addEventListenersToPeerConnection(n,e)},r.createConnection=function(){return new RTCPeerConnection({iceServers:r.state.token.iceServers})},r.addStreamToPeerConnection=function(e){return e.addStream(r.state.localStream),e},r.addEventListenersToPeerConnection=function(e,t){return e.onaddstream=function(e){var n=Object(o.createRef)();n.current={},n.current.srcObject=e.stream,r.remoteVideos.current.push({id:t.userId,remoteVideo:n}),r.setState((function(n){return Object(p.a)(Object(p.a)({},n),{},{remoteStreams:[].concat(Object(f.a)(n.remoteStreams),[{key:t.userId,remoteStream:e.stream}])})})),console.log("remote videos updated")},e.onicecandidate=function(e){if(e.candidate){var n={id:t.userId,candidate:e.candidate};r.connectionStatuses.current[t.userId]?(r.socket.current.emit("candidate",JSON.stringify(n)),console.log("candidate emitted")):r.localICECandidates.current[t.userId]=n.candidate}},e},r.onCandidate=function(e){console.log("candidate received");var t=JSON.parse(e);console.log(t);var n=new RTCIceCandidate(t.candidate);console.log("rtcCandidate",n),r.peerConnections.current.filter((function(e){return t.id===e.id}))[0].peerConnection.addIceCandidate(n),console.log(r.remoteVideos.current)},r.localVideo=Object(o.createRef)(),r.remoteVideos=Object(o.createRef)([]),r.remoteVideo1=Object(o.createRef)(),r.remoteVideo1.current={},r.remoteVideo2=Object(o.createRef)(),r.remoteVideo2.current={},r.remoteVideo3=Object(o.createRef)(),r.remoteVideo3.current={},r.socket=Object(o.createRef)(),r.peers=Object(o.createRef)([]),r.peerConnections=Object(o.createRef)([]),r.localICECandidates=Object(o.createRef)({}),r.connectionStatuses=Object(o.createRef)({}),r.roomId=e.match.params.roomID,r}return Object(C.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.peers.current=[],this.peerConnections.current=[],this.remoteVideos.current=[],this.connectionStatuses.current={},this.localICECandidates.current={},this.socket.current=O.a.connect("https://signals-server.herokuapp.com"),navigator.mediaDevices.getUserMedia({video:{height:window.innerHeight/2,width:window.innerWidth/2},audio:!0}).then((function(t){e.onMediaStream(t)})).catch((function(e){alert("Your browser does not support WebRTC")}))}},{key:"render",value:function(){var e=this.state.remoteStreams,t=e.length,n=[];return t&&(1===t?(this.remoteVideo1.current.srcObject=e[0].remoteStream,n.push(e[0].key)):2===t?(this.remoteVideo1.current.srcObject=e[0].remoteStream,this.remoteVideo2.current.srcObject=e[1].remoteStream,n.push(e[0].key),n.push(e[1].key)):3===t&&(this.remoteVideo1.current.srcObject=e[0].remoteStream,this.remoteVideo2.current.srcObject=e[1].remoteStream,this.remoteVideo3.current.srcObject=e[2].remoteStream,n.push(e[0].key),n.push(e[1].key),n.push(e[2].key))),r.a.createElement(y,{localVideo:this.localVideo,keys:n,remoteVideos:[this.remoteVideo1,this.remoteVideo2,this.remoteVideo3]})}}]),n}(o.Component);var _=function(){return r.a.createElement(i.a,null,r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/",exact:!0,component:m}),r.a.createElement(s.a,{path:"/rooms/:roomID",component:N})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(_,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[53,1,2]]]);
//# sourceMappingURL=main.9c224544.chunk.js.map